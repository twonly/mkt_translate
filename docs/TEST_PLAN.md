# AI 翻译工作台测试用例

## 1. 功能冒烟测试
- **翻译成功（默认 Prompt）**
  - 前置：启动服务，保持 `DEEPSEEK_API_KEY` 未配置（走 Mock）或已配置（真实调用）。
  - 步骤：输入中等长度原文（含 2-3 段）、选择 `en-US` → `zh-CN`、使用默认 Prompt 点击“立即翻译”。
  - 预期：翻译状态提示，结果区域出现译文；元信息展示模型、耗时、Token 等；历史记录新增条目且位于顶部。
- **Prompt 重置**
  - 步骤：手动修改 Prompt 文本，点击“重置 Prompt”。
  - 预期：Prompt 文本恢复为默认模板，状态栏提示已重置。
- **翻译评估**
  - 前置：完成一次翻译。
  - 步骤：点击“评估翻译”。
  - 预期：按钮进入“评估中”，评估完成后展示各维度分数、平均分、整体点评与建议；若无 API Key，则返回 Mock 评分。
- **保存默认配置**
  - 步骤：调整目标语言/模型/Prompt，点击“保存默认设置”，刷新页面。
  - 预期：状态栏提示保存成功；刷新后表单各字段自动回填为保存值；重置 Prompt 恢复为保存模板。

## 2. 历史记录与复用
- **历史持久化**
  - 步骤：连续触发 2 次翻译，刷新页面。
  - 预期：右侧列表展示 2 条记录，刷新后仍存在；`data/history.json` 新增对应条目。
- **搜索与星标过滤**
  - 步骤：在搜索框输入关键字命中过滤结果；点击星标按钮；开启“仅看星标”开关。
  - 预期：列表实时过滤，仅显示匹配项；星标状态变更持久；开启过滤后仅展示已星标的条目。
- **加载历史回填**
  - 步骤：选择任意历史条目点击“加载”。
  - 预期：表单字段回填为该记录的原文、目标语言、模型、术语表、Prompt；译文与评估区域同步显示该记录的内容。
- **历史导出**
  - 步骤：点击“导出JSON”与“导出CSV”按钮。
  - 预期：浏览器下载相应文件；CSV 中字段包含评分均值、建议、备注等信息。

## 3. 术语库与标注
- **预置术语库导入**
  - 步骤：选择目标语言为 `ja-JP`，在术语库下拉选择“营销品牌术语库（zh→ja）”，点击预览。
  - 预期：预览面板展示前5条术语；译文中命中术语以底色高亮，悬浮提示“原文：xxx”。
- **术语库 + 自定义叠加**
  - 步骤：在选择术语库的同时，在自定义术语表中新增一条术语并翻译。
  - 预期：译文高亮同时兼顾自定义术语；历史记录 `glossarySnapshot` 保存术语库条目，自定义术语记录在 `glossary` 字段。
- **标注提交与列表**
  - 步骤：点击译文中的高亮词或框选句段，侧栏自动填入“定位句段”；选择问题类型、填写描述与建议译法后提交。
  - 预期：`POST /api/annotations` 返回 201，标注默认状态“review”；列表计数实时更新，历史记录 `annotations` 字段增加。
- **标注加载与状态**
  - 步骤：加载已有历史记录，观察侧栏列表；通过状态筛选查看“待审核/已采纳/已驳回”，并下拉修改状态。
  - 预期：`GET /api/annotations?recordId=...` 返回先前标注；状态筛选生效，`PUT /api/annotations/:id` 调用成功后列表与计数同步刷新。
- **译文朗读（MiniMax TTS）**
  - 步骤：翻译后点击“朗读译文”，选择音色。
  - 预期：前端调用 `POST /api/tts` 成功返回音频 URL，播放器显示并可播放/暂停/下载；未配置 API Key 时使用 Mock 音频并提示。
- **备注保存**
  - 步骤：对当前翻译输入备注，点击“保存备注”。
  - 预期：状态提示保存成功，历史卡片显示“已备注”标识，刷新后备注内容仍在。

## 4. API 层回归
- **翻译接口校验**
  - 请求：`POST /api/translate`，缺失 `sourceText`。
  - 预期：返回 400 和错误信息 `"sourceText is required"`。
- **评估独立调用**
  - 请求：`POST /api/evaluate`，传入 `sourceText` 与 `translation`（不带 `recordId`）。
  - 预期：返回 `evaluation` 对象（Mock 或真实 LLM 输出）；不写入历史。
- **星标与备注接口**
  - 请求：`POST /api/history/:id/star` 与 `PUT /api/history/:id/note`。
  - 预期：返回最新记录对象，`starred`/`userNote` 字段更新。
- **术语库接口**
  - 请求：`GET /api/glossaries`、`GET /api/glossaries/:id`。
  - 预期：前者按领域/语言过滤；后者返回术语明细，数量与前端一致。
- **标注接口**
  - 请求：`GET /api/annotations?recordId=xxx`、`POST /api/annotations`、`PUT /api/annotations/:id`。
  - 预期：列表返回记录；创建返回 201 并附带更新后的历史记录；更新可调整状态（如审核通过）。
- **系统设置与健康检查**
  - 请求：`GET /api/health`、`GET /api/settings`、`PUT /api/settings`、`GET /api/history/export?format=csv`。
  - 预期：返回系统状态、保存默认配置成功；导出接口返回带 `Content-Disposition` 的文件流。

## 5. 边界与异常
- **长文本处理**
  - 输入 5k 字符以上原文（如多段文案），验证提交成功且无前端卡顿。
  - 预期：翻译按钮在请求期间禁用；Mock 环境输出完整译文；历史保存成功。
- **重复翻译**
  - 对同一原文使用不同 Prompt 或模型重复翻译。
  - 预期：历史记录分别保存，便于比对；加载任一条记录不会污染另一条数据。
- **无网络/DeepSeek 报错**
  - 手动断网或者伪造 DeepSeek 500 错误（例如设置错误 API Key）。
  - 预期：接口返回错误信息，前端状态栏展示“翻译失败/评估失败”，按钮恢复可用。
- **速率限制与日志**
  - 连续快速请求 `/api/translate` 超过 60 次/分钟。
  - 预期：返回 429 状态，日志文件 `logs/app.log` 记录限流事件；常规翻译/评估成功后日志包含耗时、Token 消耗等字段。

## 6. 验证结果记录
- Mock 环境下已通过脚本验证核心调用（见 `node src/server/deepseekClient.js` 调用日志）。
- 建议在接入真实 DeepSeek API Key 后，按上述用例回归，重点确认：
  1. Token 计数与耗时展示正常；
  2. 评估 JSON 解析无报错；
  3. 历史记录文件持续写入无冲突。
- 日志文件：`logs/app.log` 应出现翻译成功、评估成功、限流警告等记录，可作为次日审阅的调试凭证。
